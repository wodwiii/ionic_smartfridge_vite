System.register(["./index-legacy-kQyf5nXb.js"],(function(e,t){"use strict";var i,n,a,s,r;return{setters:[e=>{i=e.W,n=e.P,a=e.a,s=e.A,r=e.G}],execute:function(){const t=(e,t)=>{return"string"==typeof e&&(t=e,e=void 0),(i=e,o(i)).includes(t);var i},o=(e=window)=>{if(void 0===e)return[];e.Ionic=e.Ionic||{};let t=e.Ionic.platforms;return null==t&&(t=e.Ionic.platforms=l(e),t.forEach((t=>e.document.documentElement.classList.add(`plt-${t}`)))),t},l=e=>Object.keys(w).filter((t=>w[t](e))),p=e=>!!d(e,/iPad/i)||!(!d(e,/Macintosh/i)||!y(e)),h=e=>d(e,/android|sink/i),y=e=>b(e,"(any-pointer:coarse)"),c=e=>u(e)||m(e),u=e=>!!(e.cordova||e.phonegap||e.PhoneGap),m=e=>{const t=e.Capacitor;return!!(null==t?void 0:t.isNative)},d=(e,t)=>t.test(e.navigator.userAgent),b=(e,t)=>e.matchMedia(t).matches,w={ipad:p,iphone:e=>d(e,/iPhone/i),ios:e=>d(e,/iPhone|iPod/i)||p(e),android:h,phablet:e=>{const t=e.innerWidth,i=e.innerHeight,n=Math.min(t,i),a=Math.max(t,i);return n>390&&n<520&&a>620&&a<800},tablet:e=>{const t=e.innerWidth,i=e.innerHeight,n=Math.min(t,i),a=Math.max(t,i);return p(e)||(e=>h(e)&&!d(e,/mobile/i))(e)||n>460&&n<820&&a>780&&a<1400},cordova:u,capacitor:m,electron:e=>d(e,/electron/i),pwa:e=>!(!e.matchMedia("(display-mode: standalone)").matches&&!e.navigator.standalone),mobile:y,mobileweb:e=>y(e)&&!c(e),desktop:e=>!y(e),hybrid:c};e("StripeWeb",class extends i{constructor(){super({name:"Stripe",platforms:["web"]})}async initialize(e){if("string"!=typeof e.publishableKey||0===e.publishableKey.trim().length)throw new Error("you must provide a valid key");this.publishableKey=e.publishableKey,e.stripeAccount&&(this.stripeAccount=e.stripeAccount)}async createPaymentSheet(e){var t;this.publishableKey?(this.paymentSheet=document.createElement("stripe-payment-sheet"),null===(t=document.querySelector("body"))||void 0===t||t.appendChild(this.paymentSheet),await customElements.whenDefined("stripe-payment-sheet"),this.paymentSheet.publishableKey=this.publishableKey,this.stripeAccount&&(this.paymentSheet.stripeAccount=this.stripeAccount),this.paymentSheet.applicationName="@capacitor-community/stripe",this.paymentSheet.intentClientSecret=e.paymentIntentClientSecret,this.paymentSheet.intentType="payment",void 0!==e.withZipCode&&(this.paymentSheet.zip=e.withZipCode),this.notifyListeners(n.Loaded,null)):this.notifyListeners(n.FailedToLoad,null)}async presentPaymentSheet(){if(!this.paymentSheet)throw new Error;const e=await this.paymentSheet.present();if(void 0===e)return this.notifyListeners(n.Canceled,null),{paymentResult:n.Canceled};const{detail:{stripe:t,cardNumberElement:i}}=e,a=await t.createPaymentMethod({type:"card",card:i});return this.paymentSheet.updateProgress("success"),this.paymentSheet.remove(),void 0!==a.error?(this.notifyListeners(n.Failed,null),{paymentResult:n.Failed}):(this.notifyListeners(n.Completed,null),{paymentResult:n.Completed})}async createPaymentFlow(e){var i;this.publishableKey?(this.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(this.paymentSheet),await customElements.whenDefined("stripe-payment-sheet"),this.paymentSheet.publishableKey=this.publishableKey,this.stripeAccount&&(this.paymentSheet.stripeAccount=this.stripeAccount),this.paymentSheet.applicationName="@capacitor-community/stripe",e.hasOwnProperty("paymentIntentClientSecret")?(this.paymentSheet.intentType="payment",this.paymentSheet.intentClientSecret=e.paymentIntentClientSecret):(this.paymentSheet.intentType="setup",this.paymentSheet.intentClientSecret=e.setupIntentClientSecret),void 0!==e.withZipCode&&(this.paymentSheet.zip=e.withZipCode),t(window,"ios")?(this.paymentSheet.buttonLabel="Add card",this.paymentSheet.sheetTitle="Add a card"):this.paymentSheet.buttonLabel="Add",this.notifyListeners(a.Loaded,null)):this.notifyListeners(a.FailedToLoad,null)}async presentPaymentFlow(){if(!this.paymentSheet)throw new Error;this.notifyListeners(a.Opened,null);const e=await this.paymentSheet.present().catch((()=>{}));if(void 0===e)throw this.notifyListeners(a.Canceled,null),new Error;const{detail:{stripe:t,cardNumberElement:i}}=e,{token:n}=await t.createToken(i);if(void 0===n||void 0===n.card)throw new Error;return this.flowStripe=t,this.flowCardNumberElement=i,this.notifyListeners(a.Created,{cardNumber:n.card.last4}),{cardNumber:n.card.last4}}async confirmPaymentFlow(){if(!this.paymentSheet||!this.flowStripe||!this.flowCardNumberElement)throw new Error;return void 0!==(await this.flowStripe.createPaymentMethod({type:"card",card:this.flowCardNumberElement})).error&&this.notifyListeners(a.Failed,null),this.paymentSheet.updateProgress("success"),this.paymentSheet.remove(),this.notifyListeners(a.Completed,null),{paymentResult:a.Completed}}isApplePayAvailable(){return this.isAvailable("applePay")}async createApplePay(e){this.publishableKey?(this.requestApplePay=await this.createPaymentRequestButton(),this.requestApplePayOptions=e,this.notifyListeners(s.Loaded,null)):this.notifyListeners(s.FailedToLoad,null)}presentApplePay(){return this.presentPaymentRequestButton("applePay",this.requestApplePay,this.requestApplePayOptions,s)}isGooglePayAvailable(){return this.isAvailable("googlePay")}async createGooglePay(e){this.publishableKey?(this.requestGooglePay=await this.createPaymentRequestButton(),this.requestGooglePayOptions=e,this.notifyListeners(r.Loaded,null)):this.notifyListeners(r.FailedToLoad,null)}presentGooglePay(){return this.presentPaymentRequestButton("googlePay",this.requestGooglePay,this.requestGooglePayOptions,r)}async isAvailable(e){var t;const i=document.createElement("stripe-payment-request-button");return i.id=`isAvailable-${e}`,null===(t=document.querySelector("body"))||void 0===t||t.appendChild(i),await customElements.whenDefined("stripe-payment-request-button"),this.publishableKey&&(i.publishableKey=this.publishableKey),this.stripeAccount&&(i.stripeAccount=this.stripeAccount),i.applicationName="@capacitor-community/stripe",await i.isAvailable(e).finally((()=>i.remove()))}async createPaymentRequestButton(){var e;const t=document.createElement("stripe-payment-request-button");return null===(e=document.querySelector("body"))||void 0===e||e.appendChild(t),await customElements.whenDefined("stripe-payment-request-button"),this.publishableKey&&(t.publishableKey=this.publishableKey),this.stripeAccount&&(t.stripeAccount=this.stripeAccount),t.applicationName="@capacitor-community/stripe",t}async presentPaymentRequestButton(e,t,i,n){return new Promise((async a=>{if(void 0===t||void 0===i||void 0===this.publishableKey)return this.notifyListeners(n.Failed,null),a({paymentResult:n.Failed});await t.setPaymentRequestOption({country:i.countryCode.toUpperCase(),currency:i.currency.toLowerCase(),total:i.paymentSummaryItems[i.paymentSummaryItems.length-1],disableWallets:"applePay"===e?["googlePay","browserCard"]:["applePay","browserCard"],requestPayerName:!0,requestPayerEmail:!0});const s=i.paymentIntentClientSecret;await t.setPaymentMethodEventHandler((async(e,t)=>{const{paymentIntent:i,error:r}=await t.confirmCardPayment(s,{payment_method:e.paymentMethod.id},{handleActions:!1});if(r)return e.complete("fail"),this.notifyListeners(n.Failed,r),a({paymentResult:n.Failed});if("requires_action"===(null==i?void 0:i.status)){const{error:i}=await t.confirmCardPayment(s);if(i)return e.complete("fail"),this.notifyListeners(n.Failed,i),a({paymentResult:n.Failed})}return e.complete("success"),this.notifyListeners(n.Completed,null),a({paymentResult:n.Completed})})),await t.initStripe(this.publishableKey,{stripeAccount:this.stripeAccount,showButton:!1})}))}})}}}));
